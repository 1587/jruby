From: Sebastien Delafond <seb@debian.org>
Date: Thu, 29 Jul 2010 19:46:44 +0200
Subject: do not install gems

---
 build.xml |   75 +------------------------------------------------------------
 1 files changed, 1 insertions(+), 74 deletions(-)

--- a/build.xml
+++ b/build.xml
@@ -462,7 +462,6 @@
         <sysproperty key="jruby.home" value="${build.dir}/jar-complete/META-INF/jruby.home"/>
         <env key="RUBYOPT" value=""/>
         <jvmarg value="${run.jvm.model}"/>
-        <arg line="--command maybe_install_gems ${complete.jar.gems}"/>
         <arg line="--no-ri --no-rdoc --ignore-dependencies --env-shebang"/>
       </java>
 
@@ -552,7 +551,6 @@
         <sysproperty key="jruby.home" value="${build.dir}/jar-complete/META-INF/jruby.home"/>
         <env key="RUBYOPT" value=""/>
         <jvmarg value="${run.jvm.model}"/>
-        <arg line="--command maybe_install_gems ${complete.jar.gems}"/>
         <arg line="--no-ri --no-rdoc --ignore-dependencies --env-shebang"/>
       </java>
 
@@ -700,33 +698,8 @@
     </emma>
   </target>
 
-  <target name="install-dist-gems" depends="init,jar">
-    <property name="jruby.home" value="${basedir}"/>
-    <java classname="org.jruby.Main" fork="true" maxmemory="${jruby.launch.memory}" failonerror="true">
-      <classpath refid="build.classpath"/>
-      <classpath path="${jruby.classes.dir}"/>
-      <sysproperty key="jruby.home" value="${jruby.home}"/>
-      <env key="GEM_PATH" value=""/> <!-- to ignore any gems installed in ~/.gem -->
-      <arg line="--command maybe_install_gems ${dev.gems}"/>
-    </java>
-  </target>
-
-  <target name="install-jruby-launcher-gem" depends="init,jar">
-    <property name="jruby.home" value="${basedir}"/>
-    <java classname="org.jruby.Main" fork="true" maxmemory="${jruby.launch.memory}" failonerror="false">
-      <classpath refid="build.classpath"/>
-      <classpath path="${jruby.classes.dir}"/>
-      <sysproperty key="jruby.home" value="${jruby.home}"/>
-      <env key="GEM_PATH" value=""/> <!-- to ignore any gems installed in ~/.gem -->
-      <arg line="--command maybe_install_gems ${jruby.launcher.gem}"/>
-    </java>
-  </target>
-
-  <target name="install-gems" depends="install-dist-gems,install-jruby-launcher-gem"/>
-
   <target name="test" depends="
     copy-test-files,
-    install-gems,
     run-junit-interpreted-short,
     test-rake-targets"
     description="Runs unit tests.">
@@ -734,7 +707,6 @@
 
   <target name="test-indy" depends="
     copy-test-files,
-    install-gems,
     run-junit-indy-short,
     test-rake-targets"
     description="Runs unit tests.">
@@ -742,7 +714,6 @@
 
   <target name="test-extended" depends="
     copy-test-files,
-    install-gems,
     run-junit-compiled,
     run-junit-embed,
     test-rake-targets"
@@ -1076,48 +1047,6 @@
     </sequential>
   </macrodef>
 
-  <!-- Utilities to manage rubyspecs/mspec files -->
-  <target name="fetch-stable-specs" depends="init">
-    <rake task="spec:fetch_stable_specs"/>
-  </target>
-  <target name="fetch-latest-specs" depends="init">
-    <rake task="spec:fetch_latest_specs"/>
-  </target>
-
-  <!-- Main spec runs (See rakelib/spec.rake for definitions/descriptions) -->
-  <target name="spec:ci_18" depends="install-gems"><rake task="spec:ci_18"/></target>
-  <target name="spec:ci_19" depends="install-gems"><rake task="spec:ci_19"/></target>
-  <target name="spec:ci_interpreted_18_19" depends="install-gems">
-    <rake task="spec:ci_interpreted_18_19"/>
-  </target>
-  <target name="spec:ci_interpreted_18" depends="install-gems">
-    <rake task="spec:ci_interpreted_18"/>
-  </target>
-  <target name="spec:ci_interpreted_19" depends="install-gems">
-    <rake task="spec:ci_interpreted_19"/>
-  </target>
-  <target name="spec:ci_all_precompiled_18" depends="install-gems">
-    <rake task="spec:ci_all_precompiled_18"/>
-  </target>
-  <target name="spec:ci_all_interpreted_18" depends="install-gems">
-    <rake task="spec:ci_all_interpreted_18"/>
-  </target>
-  <target name="spec:ci_all" depends="install-gems"><rake task="spec:ci_all"/></target>
-  <target name="spec:ci_latest" depends="install-gems"><rake task="spec:ci_latest"/></target>
-
-  <!-- Old compatibility targets which call to newer Rake-based ones -->
-  <target name="spec" depends="spec:ci_18"/>
-  <target name="spec-ci" depends="spec:ci_18"/>
-  <target name="spec-short" depends="spec:ci_interpreted_18_19"/>
-  <target name="spec-ci-1.9" depends="spec:ci_19"/>
-  <target name="spec-short-1.9" depends="spec:ci_interpreted_19"/>
-  <target name="spec-all" depends="spec:ci_all_precompiled_18"/>
-  <target name="spec-all-interpreted" depends="spec:ci_all_interpreted_18"/>
-
-  <!-- latest, unstable specs -->
-  <target name="spec-latest-all" depends="spec:ci_all"/>
-  <target name="spec-latest" depends="spec:ci_latest"/>
-
   <target name="update-excludes">
     <java classname="org.jruby.Main" fork="true" maxmemory="${jruby.launch.memory}" failonerror="false" dir="${spec.dir}">
       <classpath refid="jruby.execute.classpath"/>
@@ -1299,7 +1228,6 @@
     <mkdir dir="${dist.stage.bin.dir}/lib/native"/>
     <unzip-native-libs destination.dir="${dist.stage.bin.dir}/lib/native"/>
     <fixEOLs dist-stage-dir="${dist.stage.bin.dir}"/>
-    <rake task="install_dist_gems"/>
     <tar destfile="${dist.dir}/jruby-bin-${version.jruby}.tar.gz" compression="gzip">
       <tarfileset dir="${dist.stage.bin.dir}" mode="755" prefix="jruby-${version.jruby}">
         <include name="bin/**"/>
@@ -1349,7 +1277,6 @@
         <patternset refid="dist.lib.files"/>
       </fileset>
     </copy>
-    <rake task="install_dist_gems"/>
     <fixEOLs dist-stage-dir="${dist.stage.src.dir}"/>
     <tar destfile="${dist.dir}/jruby-src-${version.jruby}.tar.gz" compression="gzip">
       <tarfileset dir="${dist.stage.src.dir}" mode="755" prefix="jruby-${version.jruby}">
@@ -1435,7 +1362,7 @@
     </antcall>
   </target>
 
-  <target name="dist" depends="install-dist-gems,dist-bin,dist-src,dist-jar-complete"/>
+  <target name="dist" depends="dist-bin,dist-src,dist-jar-complete"/>
 
   <target name="dist-clean">
     <delete dir="${dist.dir}"/>
