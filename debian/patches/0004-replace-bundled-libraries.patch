From: Hideki Yamane <henrich@debian.or.jp>
Date: Thu, 29 Jul 2010 19:46:58 +0200
Subject: [PATCH] replace bundled libraries

... and use Debian packages instead
---
 build.properties |    2 +
 build.xml        |  195 ++++++++++++++++++++----------------------------------
 2 files changed, 75 insertions(+), 122 deletions(-)
 create mode 100644 build.properties

diff --git a/build.properties b/build.properties
new file mode 100644
index 0000000..5308747
--- /dev/null
+++ b/build.properties
@@ -0,0 +1,2 @@
+build.lib.dir=/usr/share/java/
+local.build.lib.dir=build_lib
diff --git a/build.xml b/build.xml
index 5fd40cf..a08c16d 100644
--- a/build.xml
+++ b/build.xml
@@ -15,7 +15,26 @@
   <property name="shared.lib.dir" value="lib/ruby/site_ruby/shared"/>
 
   <path id="build.classpath">
-    <fileset dir="${build.lib.dir}" includes="*.jar"/>
+    <fileset dir="${build.lib.dir}">
+      <include name="asm3.jar"/>
+      <include name="asm3-commons.jar"/>
+      <include name="asm3-util.jar"/>
+      <include name="asm3-analysis.jar"/>
+      <include name="asm3-tree.jar"/>
+      <include name="libconstantine-java.jar"/>
+      <include name="joda-time.jar"/>
+      <include name="bsf.jar"/>
+      <include name="jline.jar"/>
+      <include name="junit4.jar"/>
+      <include name="jgrapht0.8.jar"/>
+      <include name="bytelist.jar"/>
+      <include name="jcodings.jar"/>
+      <include name="jaffl.jar"/>
+      <include name="jffi.jar"/>
+      <include name="joni.jar"/>
+      <include name="nailgun.jar"/>
+    </fileset>
+    <fileset dir="${local.build.lib.dir}" includes="*.jar"/>
   </path>
 
   <path id="jruby.execute.classpath">
@@ -289,39 +308,22 @@
 
       <jar destfile="${lib.dir}/jruby.jar" compress="true" index="true">
         <fileset dir="${jruby.classes.dir}"/>
-        <zipfileset src="${build.lib.dir}/asm-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-commons-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-util-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-analysis-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-tree-3.2.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-commons.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-util.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-analysis.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-tree.jar"/>
         <zipfileset src="${build.lib.dir}/bytelist.jar"/>
-        <zipfileset src="${build.lib.dir}/constantine.jar"/>
-        <zipfileset src="${build.lib.dir}/jline-0.9.93.jar"/>
+        <zipfileset src="${build.lib.dir}/libconstantine-java.jar"/>
+        <zipfileset src="${build.lib.dir}/jline.jar"/>
         <zipfileset src="${build.lib.dir}/jcodings.jar"/>
         <zipfileset src="${build.lib.dir}/joni.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-netdb.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-posix.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-netdb.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-posix.jar"/>
         <zipfileset src="${build.lib.dir}/jaffl.jar"/>
         <zipfileset src="${build.lib.dir}/jffi.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-Darwin.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-AIX.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparc-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparcv9-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-s390x-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/joda-time-1.6.jar"/>
-        <zipfileset src="${build.lib.dir}/yydebug.jar"/>
+        <zipfileset src="${build.lib.dir}/joda-time.jar"/>
+        <zipfileset src="${local.build.lib.dir}/yydebug.jar"/>
         <zipfileset src="${build.lib.dir}/nailgun-0.7.1.jar"/>
         <metainf dir="${base.dir}/spi">
           <include name="services/**"/>
@@ -345,15 +347,15 @@
             <exclude name="org/jruby/ext/ffi/**/*"/>
             <exclude name="org/jruby/embed/**/*"/>
         </fileset>
-        <zipfileset src="${build.lib.dir}/asm-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-util-3.2.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-util.jar"/>
         <zipfileset src="${build.lib.dir}/bytelist.jar"/>
-        <zipfileset src="${build.lib.dir}/constantine.jar"/>
+        <zipfileset src="${build.lib.dir}/libconstantine-java.jar"/>
         <zipfileset src="${build.lib.dir}/jcodings.jar"/>
         <zipfileset src="${build.lib.dir}/joni.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-netdb.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-posix.jar"/>
-        <zipfileset src="${build.lib.dir}/joda-time-1.6.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-netdb.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-posix.jar"/>
+        <zipfileset src="${build.lib.dir}/joda-time.jar"/>
         <manifest>
           <attribute name="Built-By" value="${user.name}"/>
           <attribute name="Main-Class" value="org.jruby.Main"/>
@@ -367,39 +369,22 @@
       <taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask" classpath="${build.lib.dir}/jarjar-1.0.jar"/>
       <jarjar destfile="${lib.dir}/jruby.jar" compress="true">
         <fileset dir="${jruby.classes.dir}"/>
-        <zipfileset src="${build.lib.dir}/asm-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-commons-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-util-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-analysis-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-tree-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/constantine.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-commons.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-util.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-analysis.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-tree.jar"/>
+        <zipfileset src="${build.lib.dir}/libconstantine-java.jar"/>
         <zipfileset src="${build.lib.dir}/bytelist.jar"/>
-        <zipfileset src="${build.lib.dir}/jline-0.9.93.jar"/>
+        <zipfileset src="${build.lib.dir}/jline.jar"/>
         <zipfileset src="${build.lib.dir}/jcodings.jar"/>
         <zipfileset src="${build.lib.dir}/joni.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-netdb.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-posix.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-netdb.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-posix.jar"/>
         <zipfileset src="${build.lib.dir}/jaffl.jar"/>
         <zipfileset src="${build.lib.dir}/jffi.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-Darwin.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-AIX.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparc-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparcv9-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-s390x-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/joda-time-1.6.jar"/>
-        <zipfileset src="${build.lib.dir}/yydebug.jar"/>
+        <zipfileset src="${build.lib.dir}/joda-time.jar"/>
+        <zipfileset src="${local.build.lib.dir}/yydebug.jar"/>
         <zipfileset src="${build.lib.dir}/nailgun-0.7.1.jar"/>
         <metainf dir="${base.dir}/spi">
           <include name="services/**"/>
@@ -462,41 +447,24 @@
           <exclude name="META-INF/jruby.home/lib/ruby/site_ruby/shared/builtin/**"/>
           <exclude name="META-INF/jruby.home/lib/ruby/1.9/**"/>
         </fileset>
-        <zipfileset src="${build.lib.dir}/asm-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-commons-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-util-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-analysis-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-tree-3.2.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-commons.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-util.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-analysis.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-tree.jar"/>
         <zipfileset src="${build.lib.dir}/bytelist.jar"/>
-        <zipfileset src="${build.lib.dir}/constantine.jar"/>
-        <zipfileset src="${build.lib.dir}/jline-0.9.93.jar"/>
+        <zipfileset src="${build.lib.dir}/libconstantine-java.jar"/>
+        <zipfileset src="${build.lib.dir}/jline.jar"/>
         <zipfileset src="${build.lib.dir}/jcodings.jar"/>
         <zipfileset src="${build.lib.dir}/joni.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-netdb.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-posix.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-netdb.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-posix.jar"/>
         <zipfileset src="${build.lib.dir}/jaffl.jar"/>
         <zipfileset src="${build.lib.dir}/jffi.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-Darwin.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-AIX.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparc-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparcv9-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-s390x-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/joda-time-1.6.jar"/>
-        <zipfileset src="${build.lib.dir}/yydebug.jar"/>
+        <zipfileset src="${build.lib.dir}/joda-time.jar"/>
+        <zipfileset src="${local.build.lib.dir}/yydebug.jar"/>
         <zipfileset src="${build.lib.dir}/nailgun-0.7.1.jar"/>
-        <zipfileset src="${shared.lib.dir}/yecht.jar"/>
+        <zipfileset src="${local.shared.lib.dir}/yecht.jar"/>
         <metainf dir="${base.dir}/spi">
           <include name="services/**"/>
         </metainf>
@@ -550,41 +518,24 @@
         <fileset dir="${build.dir}/jar-complete">
           <exclude name="META-INF/jruby.home/lib/ruby/1.8/**"/>
         </fileset>
-        <zipfileset src="${build.lib.dir}/asm-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-commons-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-util-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-analysis-3.2.jar"/>
-        <zipfileset src="${build.lib.dir}/asm-tree-3.2.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-commons.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-util.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-analysis.jar"/>
+        <zipfileset src="${build.lib.dir}/asm3-tree.jar"/>
         <zipfileset src="${build.lib.dir}/bytelist.jar"/>
-        <zipfileset src="${build.lib.dir}/constantine.jar"/>
-        <zipfileset src="${build.lib.dir}/jline-0.9.93.jar"/>
+        <zipfileset src="${build.lib.dir}/libconstantine-java.jar"/>
+        <zipfileset src="${build.lib.dir}/jline.jar"/>
         <zipfileset src="${build.lib.dir}/jcodings.jar"/>
         <zipfileset src="${build.lib.dir}/joni.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-netdb.jar"/>
-        <zipfileset src="${build.lib.dir}/jnr-posix.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-netdb.jar"/>
+        <zipfileset src="${local.build.lib.dir}/jnr-posix.jar"/>
         <zipfileset src="${build.lib.dir}/jaffl.jar"/>
         <zipfileset src="${build.lib.dir}/jffi.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-Darwin.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-AIX.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-ppc64-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparc-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-sparcv9-SunOS.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-FreeBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-OpenBSD.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-i386-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-x86_64-Windows.jar"/>
-        <zipfileset src="${build.lib.dir}/jffi-s390x-Linux.jar"/>
-        <zipfileset src="${build.lib.dir}/joda-time-1.6.jar"/>
-        <zipfileset src="${build.lib.dir}/yydebug.jar"/>
+        <zipfileset src="${build.lib.dir}/joda-time.jar"/>
+        <zipfileset src="${local.build.lib.dir}/yydebug.jar"/>
         <zipfileset src="${build.lib.dir}/nailgun-0.7.1.jar"/>
-        <zipfileset src="${shared.lib.dir}/yecht.jar"/>
+        <zipfileset src="${local.shared.lib.dir}/yecht.jar"/>
         <metainf dir="${base.dir}/spi">
           <include name="services/**"/>
         </metainf>
@@ -757,7 +708,7 @@
 
   <path id="test.class.path">
     <pathelement path="${build.lib.dir}/junit.jar"/>
-    <pathelement path="${build.lib.dir}/livetribe-jsr223-2.0.6.jar"/>
+    <pathelement path="${build.lib.dir}/livetribe-jsr223.jar"/>
     <pathelement path="${build.lib.dir}/bsf.jar"/>
     <pathelement path="${build.lib.dir}/commons-logging-1.1.1.jar"/>
     <pathelement path="${java.class.path}"/>
-- 
